<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Admin - BAPS Mandir</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .admin-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .admin-header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .admin-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .admin-card:hover {
            transform: translateY(-5px);
        }
        
        .admin-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .admin-card p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .admin-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }
        
        .admin-btn:hover {
            background: #2980b9;
        }
        
        .admin-btn.danger {
            background: #e74c3c;
        }
        
        .admin-btn.danger:hover {
            background: #c0392b;
        }
        
        .admin-btn.success {
            background: #27ae60;
        }
        
        .admin-btn.success:hover {
            background: #229954;
        }
        
        .admin-btn.warning {
            background: #f39c12;
        }
        
        .admin-btn.warning:hover {
            background: #e67e22;
        }
        
        .status-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-btn:hover {
            background: rgba(0, 0, 0, 0.7);
        }
        
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        
        .message.success {
            background: #27ae60;
        }
        
        .message.error {
            background: #e74c3c;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            color: #333;
        }
        
        .modal-header {
            background: #3498db;
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: white;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 0 0 15px 15px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .upload-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
        }
        
        .upload-section h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .upload-section p {
            color: #6c757d;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .upload-section input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            cursor: pointer;
        }
        
        .upload-section input[type="file"]:hover {
            border-color: #3498db;
        }
        
        .image-preview {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .image-preview img {
            max-width: 150px;
            height: auto;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }
        
        .image-item {
            display: inline-block;
            margin: 10px;
            text-align: center;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .image-item img {
            max-width: 100px;
            height: auto;
            border-radius: 5px;
        }
        
        .image-item p {
            margin: 5px 0 0 0;
            font-size: 12px;
            color: #6c757d;
        }

        /* URL Upload Styles */
        .url-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
        }

        .url-section h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .url-section p {
            color: #6c757d;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .url-section textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            min-height: 100px;
            resize: vertical;
        }

        .url-section input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            font-size: 14px;
        }

        .url-preview {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .url-preview img {
            max-width: 100px;
            height: auto;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        .url-preview p {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        /* Language Manager Styles */
        .language-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
        }

        .language-section h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .language-section p {
            color: #6c757d;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .language-section strong {
            color: #3498db;
        }

        .language-section ul {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        .language-section li {
            margin-bottom: 5px;
            color: #555;
        }

        /* Upcoming Dates Manager Styles */
        .dates-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
        }

        .dates-section h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .event-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .form-input {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            font-size: 14px;
        }

        .form-textarea {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            min-height: 80px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <a href="/" class="back-btn">
        ← Back to Kiosk
    </a>
    
    <div class="admin-container">
        <div class="admin-header">
            <h1>🔐 Admin Controls</h1>
            <p>Simple admin panel for BAPS Mandir Kiosk</p>
        </div>
        
        <div class="admin-grid">
            <div class="admin-card">
                <h3>🖼️ Image Management</h3>
                <p>Manage hero slider images and gallery content</p>
                <button class="admin-btn" onclick="loadDefaultImages()">Load Default Images</button>
                <button class="admin-btn" onclick="checkImageStatus()">Check Image Status</button>
                <button class="admin-btn" onclick="showImageUpload()">Upload New Images</button>
                <button class="admin-btn" onclick="showAddByURL()">Add Images by URL</button>
                <button class="admin-btn" onclick="viewCurrentImages()">View Current Images</button>
                <button class="admin-btn warning" onclick="removeDefaultImages()">Remove Default Images</button>
                <button class="admin-btn danger" onclick="removeAllImages()">Remove All Images</button>
            </div>
            
            <div class="admin-card">
                <h3>🌍 Language & Content</h3>
                <p>Manage languages and upcoming dates</p>
                <button class="admin-btn" onclick="showLanguageManager()">Language Manager</button>
                <button class="admin-btn" onclick="showUpcomingDatesManager()">Manage Upcoming Dates</button>
                <button class="admin-btn" onclick="testLanguageSwitch()">Test Language Switch</button>
                <button class="admin-btn" onclick="exportLanguageData()">Export Language Data</button>
            </div>
            
            <div class="admin-card">
                <h3>🔄 Content Refresh</h3>
                <p>Refresh dynamic content and update displays</p>
                <button class="admin-btn success" onclick="refreshContent()">Refresh Content</button>
                <button class="admin-btn" onclick="clearCache()">Clear Cache</button>
            </div>
            
            <div class="admin-card">
                <h3>🧪 System Tests</h3>
                <p>Run diagnostic tests and check system health</p>
                <button class="admin-btn" onclick="runSystemTest()">Run System Test</button>
                <button class="admin-btn" onclick="checkLocalStorage()">Check Storage</button>
            </div>
            
            <div class="admin-card">
                <h3>📊 System Status</h3>
                <p>View current system status and performance</p>
                <button class="admin-btn" onclick="showSystemStatus()">Show Status</button>
                <button class="admin-btn" onclick="exportData()">Export Data</button>
            </div>
        </div>
        
        <!-- Image Upload Modal -->
        <div id="image-upload-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>📤 Upload New Images</h3>
                    <button class="modal-close" onclick="hideImageUpload()">&times;</button>
                </div>
                
                <div class="modal-body">
                    <div class="upload-section">
                        <h4>Hero Slider Images</h4>
                        <p>Upload images for the main hero slider (recommended: 1080x600)</p>
                        <input type="file" id="hero-images" multiple accept="image/*" onchange="previewImages('hero-images', 'hero-preview')">
                        <div id="hero-preview" class="image-preview"></div>
                    </div>
                    
                    <div class="upload-section">
                        <h4>Gallery Images</h4>
                        <p>Upload images for the photo gallery (recommended: 400x300)</p>
                        <input type="file" id="gallery-images" multiple accept="image/*" onchange="previewImages('gallery-images', 'gallery-preview')">
                        <div id="gallery-preview" class="image-preview"></div>
                    </div>
                    
                    <div class="upload-section">
                        <h4>Murti Darshan Image</h4>
                        <p>Upload the main murti darshan image (recommended: 400x300)</p>
                        <input type="file" id="murti-image" accept="image/*" onchange="previewImages('murti-image', 'murti-preview')">
                        <div id="murti-preview" class="image-preview"></div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="admin-btn" onclick="processImageUpload()">Upload Images</button>
                    <button class="admin-btn" onclick="hideImageUpload()">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Current Images Modal -->
        <div id="current-images-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🖼️ Current Images</h3>
                    <button class="modal-close" onclick="hideCurrentImages()">&times;</button>
                </div>
                
                <div class="modal-body">
                    <div id="current-images-content"></div>
                </div>
                
                <div class="modal-footer">
                    <button class="admin-btn danger" onclick="clearAllImages()">Clear All Images</button>
                    <button class="admin-btn" onclick="hideCurrentImages()">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Add Images by URL Modal -->
        <div id="add-url-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🔗 Add Images by URL</h3>
                    <button class="modal-close" onclick="hideAddByURL()">&times;</button>
                </div>
                
                <div class="modal-body">
                    <div class="url-section">
                        <h4>Hero Slider Images</h4>
                        <p>Add image URLs for the main hero slider (one per line)</p>
                        <textarea id="hero-urls" placeholder="https://example.com/image1.jpg&#10;https://example.com/image2.jpg&#10;https://example.com/image3.jpg" rows="4" oninput="previewURLImages('hero-urls', 'hero-url-preview')"></textarea>
                        <div class="url-preview" id="hero-url-preview"></div>
                    </div>
                    
                    <div class="url-section">
                        <h4>Gallery Images</h4>
                        <p>Add image URLs for the photo gallery (one per line)</p>
                        <textarea id="gallery-urls" placeholder="https://example.com/gallery1.jpg&#10;https://example.com/gallery2.jpg&#10;https://example.com/gallery3.jpg" rows="4" oninput="previewURLImages('gallery-urls', 'gallery-url-preview')"></textarea>
                        <div class="url-preview" id="gallery-url-preview"></div>
                    </div>
                    
                    <div class="url-section">
                        <h4>Murti Darshan Image</h4>
                        <p>Add the main murti darshan image URL</p>
                        <input type="text" id="murti-url" placeholder="https://example.com/murti.jpg" class="url-input" oninput="previewURLImages('murti-url', 'murti-url-preview')">
                        <div class="url-preview" id="murti-url-preview"></div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="admin-btn" onclick="processURLImages()">Add Images</button>
                    <button class="admin-btn" onclick="hideAddByURL()">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Language Manager Modal -->
        <div id="language-manager-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🌍 Language Manager</h3>
                    <button class="modal-close" onclick="hideLanguageManager()">&times;</button>
                </div>
                
                <div class="modal-body">
                    <div class="language-section">
                        <h4>Current Language</h4>
                        <p>Main kiosk is currently displaying in: <strong id="current-language-display">English</strong></p>
                        <button class="admin-btn" onclick="changeLanguageFromAdmin('en')">Switch to English</button>
                        <button class="admin-btn" onclick="changeLanguageFromAdmin('gu')">Switch to Gujarati</button>
                        <button class="admin-btn" onclick="changeLanguageFromAdmin('hi')">Switch to Hindi</button>
                    </div>
                    
                    <div class="language-section">
                        <h4>Language Status</h4>
                        <div id="language-status-display">
                            <p>✅ English - Fully supported</p>
                            <p>✅ Gujarati - Fully supported</p>
                            <p>✅ Hindi - Fully supported</p>
                        </div>
                    </div>
                    
                    <div class="language-section">
                        <h4>Language Features</h4>
                        <ul>
                            <li>🌐 Header and navigation text</li>
                            <li>📝 Hero slider content</li>
                            <li>🗓️ Upcoming dates and events</li>
                            <li>🤖 AI assistant interface</li>
                            <li>📱 All buttons and labels</li>
                        </ul>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="admin-btn" onclick="hideLanguageManager()">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Upcoming Dates Manager Modal -->
        <div id="upcoming-dates-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🗓️ Manage Upcoming Dates</h3>
                    <button class="modal-close" onclick="hideUpcomingDatesManager()">&times;</button>
                </div>
                
                <div class="modal-body">
                    <div class="dates-section">
                        <h4>Current Upcoming Dates</h4>
                        <p>These dates are displayed in the "Upcoming Dates" section on the main kiosk</p>
                        <div id="current-dates-display"></div>
                    </div>
                    
                    <div class="dates-section">
                        <h4>Add New Event</h4>
                        <div class="event-form">
                            <input type="text" id="new-event-date" placeholder="Date (e.g., 15 Dec)" class="form-input">
                            <input type="text" id="new-event-title" placeholder="Event Title" class="form-input">
                            <input type="text" id="new-event-time" placeholder="Time (e.g., 7:00 PM)" class="form-input">
                            <textarea id="new-event-description" placeholder="Event Description" class="form-textarea" rows="3"></textarea>
                            <button class="admin-btn" onclick="addNewEvent()">Add Event</button>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="admin-btn" onclick="hideUpcomingDatesManager()">Close</button>
                </div>
            </div>
        </div>
        
        <div class="status-display" id="status-display" style="display: none;">
            <h3>System Status</h3>
            <div id="status-content"></div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        // Simple admin functions
        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
        
        function loadDefaultImages() {
            showMessage('Loading default images...', 'success');
            
            // Check if config is available
            if (typeof MANDIR_CONFIG !== 'undefined' && MANDIR_CONFIG.gallery) {
                const defaultImages = MANDIR_CONFIG.gallery.map((img, index) => ({
                    url: img.src,
                    title: img.title || `Image ${index + 1}`,
                    description: img.alt || ''
                }));
                
                // Save to localStorage
                const imageData = {
                    heroSlider: defaultImages,
                    generalImages: defaultImages,
                    murtiDarshan: defaultImages[0]
                };
                
                localStorage.setItem('kioskImages', JSON.stringify(imageData));
                showMessage('Default images loaded successfully!', 'success');
                
                // Also save to main kiosk data
                const kioskData = {
                    websiteImages: imageData,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('kioskData', JSON.stringify(kioskData));
                
            } else {
                // Fallback images
                const fallbackImages = [
                    {
                        url: 'https://images.unsplash.com/photo-1542810634-71277d95dcbb?w=1080&h=600&fit=crop',
                        title: 'BAPS Mandir Exterior',
                        description: 'Beautiful architecture of our temple'
                    },
                    {
                        url: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=1080&h=600&fit=crop',
                        title: 'Prayer Hall',
                        description: 'Sacred space for meditation and prayer'
                    },
                    {
                        url: 'https://images.unsplash.com/photo-1606092195730-5d7b9af1efc5?w=1080&h=600&fit=crop',
                        title: 'Aarti Ceremony',
                        description: 'Daily devotional ceremonies'
                    }
                ];
                
                const imageData = {
                    heroSlider: fallbackImages,
                    generalImages: fallbackImages,
                    murtiDarshan: fallbackImages[0]
                };
                
                localStorage.setItem('kioskImages', JSON.stringify(imageData));
                localStorage.setItem('kioskData', JSON.stringify({
                    websiteImages: imageData,
                    lastUpdated: new Date().toISOString()
                }));
                
                showMessage('Fallback images loaded successfully!', 'success');
            }
        }
        
        function checkImageStatus() {
            const savedImages = localStorage.getItem('kioskImages');
            const kioskData = localStorage.getItem('kioskData');
            
            let status = 'No images found';
            
            if (savedImages) {
                try {
                    const images = JSON.parse(savedImages);
                    if (images.heroSlider && images.heroSlider.length > 0) {
                        status = `${images.heroSlider.length} hero images loaded`;
                    }
                } catch (e) {
                    status = 'Error parsing image data';
                }
            }
            
            if (kioskData) {
                try {
                    const data = JSON.parse(kioskData);
                    if (data.websiteImages) {
                        status += ` | Kiosk data available`;
                    }
                } catch (e) {
                    status += ` | Error parsing kiosk data`;
                }
            }
            
            showMessage(status, 'success');
        }
        
        function refreshContent() {
            showMessage('Refreshing content...', 'success');
            
            // Trigger a storage event to notify the main kiosk
            const event = new StorageEvent('storage', {
                key: 'kioskData',
                newValue: localStorage.getItem('kioskData'),
                url: window.location.href
            });
            window.dispatchEvent(event);
            
            showMessage('Content refresh triggered!', 'success');
        }
        
        function clearCache() {
            showMessage('Clearing cache...', 'success');
            
            // Clear localStorage
            localStorage.clear();
            
            // Clear sessionStorage
            sessionStorage.clear();
            
            showMessage('Cache cleared successfully!', 'success');
        }
        
        function runSystemTest() {
            showMessage('Running system test...', 'success');
            
            const tests = [
                { name: 'Config Loaded', result: typeof MANDIR_CONFIG !== 'undefined' },
                { name: 'LocalStorage', result: typeof localStorage !== 'undefined' },
                { name: 'SessionStorage', result: typeof sessionStorage !== 'undefined' },
                { name: 'Images in Storage', result: localStorage.getItem('kioskImages') !== null }
            ];
            
            const passed = tests.filter(t => t.result).length;
            const total = tests.length;
            
            showMessage(`System test: ${passed}/${total} passed`, passed === total ? 'success' : 'error');
        }
        
        function checkLocalStorage() {
            const keys = ['kioskData', 'kioskImages', 'websiteImagesData', 'newsData'];
            let status = 'Storage Status:\n';
            
            keys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        status += `✅ ${key}: ${typeof parsed}\n`;
                    } catch (e) {
                        status += `⚠️ ${key}: Invalid JSON\n`;
                    }
                } else {
                    status += `❌ ${key}: Not found\n`;
                }
            });
            
            showMessage(status, 'success');
        }
        
        function showSystemStatus() {
            const statusDisplay = document.getElementById('status-display');
            const statusContent = document.getElementById('status-content');
            
            const status = {
                'Current Time': new Date().toLocaleString(),
                'Config Loaded': typeof MANDIR_CONFIG !== 'undefined' ? 'Yes' : 'No',
                'Images in Storage': localStorage.getItem('kioskImages') ? 'Yes' : 'No',
                'Kiosk Data': localStorage.getItem('kioskData') ? 'Yes' : 'No',
                'Storage Available': typeof localStorage !== 'undefined' ? 'Yes' : 'No',
                'Last Updated': localStorage.getItem('kioskData') ? 
                    new Date(JSON.parse(localStorage.getItem('kioskData')).lastUpdated || Date.now()).toLocaleString() : 'Never'
            };
            
            statusContent.innerHTML = Object.entries(status).map(([key, value]) => 
                `<div class="status-item">
                    <span><strong>${key}:</strong></span>
                    <span>${value}</span>
                </div>`
            ).join('');
            
            statusDisplay.style.display = 'block';
        }
        
        function exportData() {
            try {
                const exportData = {
                    timestamp: new Date().toISOString(),
                    localStorage: {},
                    sessionStorage: {},
                    kioskData: null
                };
                
                // Export localStorage
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key) {
                        exportData.localStorage[key] = localStorage.getItem(key);
                    }
                }
                
                // Export sessionStorage
                for (let i = 0; i < sessionStorage.length; i++) {
                    const key = sessionStorage.key(i);
                    if (key) {
                        exportData.sessionStorage[key] = sessionStorage.getItem(key);
                    }
                }
                
                // Export kiosk data
                const savedData = localStorage.getItem('kioskData');
                if (savedData) {
                    try {
                        exportData.kioskData = JSON.parse(savedData);
                    } catch (error) {
                        exportData.kioskData = savedData;
                    }
                }
                
                // Create and download file
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `kiosk-data-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                
                showMessage('Data exported successfully!', 'success');
                
            } catch (error) {
                console.error('Error exporting data:', error);
                showMessage('Error exporting data. Please try again.', 'error');
            }
        }
        
        // Image Upload Functions
        function showImageUpload() {
            document.getElementById('image-upload-modal').style.display = 'block';
        }

        function hideImageUpload() {
            document.getElementById('image-upload-modal').style.display = 'none';
            document.getElementById('hero-preview').innerHTML = '';
            document.getElementById('gallery-preview').innerHTML = '';
            document.getElementById('murti-preview').innerHTML = '';
        }

        function previewImages(inputId, previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = ''; // Clear previous previews
            const files = document.getElementById(inputId).files;
            for (let i = 0; i < files.length; i++) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '100%';
                    img.style.height = 'auto';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(files[i]);
            }
        }

        function processImageUpload() {
            const heroImages = document.getElementById('hero-images').files;
            const galleryImages = document.getElementById('gallery-images').files;
            const murtiImage = document.getElementById('murti-image').files;

            if (heroImages.length === 0 && galleryImages.length === 0 && murtiImage.length === 0) {
                showMessage('Please select at least one image to upload.', 'error');
                return;
            }

            const formData = new FormData();
            if (heroImages.length > 0) {
                for (let i = 0; i < heroImages.length; i++) {
                    formData.append('heroImages', heroImages[i]);
                }
            }
            if (galleryImages.length > 0) {
                for (let i = 0; i < galleryImages.length; i++) {
                    formData.append('galleryImages', galleryImages[i]);
                }
            }
            if (murtiImage.length > 0) {
                formData.append('murtiImage', murtiImage[0]);
            }

            fetch('upload_images.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('Images uploaded successfully!', 'success');
                    hideImageUpload();
                    refreshContent(); // Refresh content to show new images
                } else {
                    showMessage(`Upload failed: ${data.message}`, 'error');
                }
            })
            .catch(error => {
                console.error('Error uploading images:', error);
                showMessage('Error uploading images. Please try again.', 'error');
            });
        }

        function viewCurrentImages() {
            const currentImagesContent = document.getElementById('current-images-content');
            currentImagesContent.innerHTML = ''; // Clear previous content

            const savedImages = localStorage.getItem('kioskImages');
            if (savedImages) {
                try {
                    const images = JSON.parse(savedImages);
                    const heroSlider = images.heroSlider || [];
                    const galleryImages = images.generalImages || [];
                    const murtiDarshan = images.murtiDarshan || [];

                    if (heroSlider.length > 0) {
                        currentImagesContent.innerHTML += '<h4>Hero Slider Images</h4>';
                        heroSlider.forEach(img => {
                            currentImagesContent.innerHTML += `<div class="image-item">
                                <img src="${img.url}" alt="${img.title}" style="max-width: 100px; height: auto;">
                                <p>${img.title}</p>
                            </div>`;
                        });
                    }
                    if (galleryImages.length > 0) {
                        currentImagesContent.innerHTML += '<h4>Gallery Images</h4>';
                        galleryImages.forEach(img => {
                            currentImagesContent.innerHTML += `<div class="image-item">
                                <img src="${img.url}" alt="${img.title}" style="max-width: 100px; height: auto;">
                                <p>${img.title}</p>
                            </div>`;
                        });
                    }
                    if (murtiDarshan.length > 0) {
                        currentImagesContent.innerHTML += '<h4>Murti Darshan Image</h4>';
                        murtiDarshan.forEach(img => {
                            currentImagesContent.innerHTML += `<div class="image-item">
                                <img src="${img.url}" alt="${img.title}" style="max-width: 100px; height: auto;">
                                <p>${img.title}</p>
                            </div>`;
                        });
                    }
                    document.getElementById('current-images-modal').style.display = 'block';
                } catch (e) {
                    showMessage('Error parsing image data for display.', 'error');
                }
            } else {
                showMessage('No images found in storage.', 'info');
            }
        }

        function clearAllImages() {
            if (confirm('Are you sure you want to clear ALL images from storage? This action cannot be undone.')) {
                localStorage.removeItem('kioskImages');
                localStorage.removeItem('kioskData'); // Also clear kiosk data
                showMessage('All images cleared successfully!', 'success');
                refreshContent(); // Refresh content to show no images
                hideCurrentImages(); // Close modal
            }
        }

        function hideCurrentImages() {
            document.getElementById('current-images-modal').style.display = 'none';
        }
        
        // Remove Images Functions
        function removeAllImages() {
            if (confirm('Are you sure you want to remove ALL images? This will clear the hero slider, gallery, and murti darshan images. This action cannot be undone.')) {
                // Clear all image data
                localStorage.removeItem('kioskImages');
                localStorage.removeItem('kioskData');
                localStorage.removeItem('websiteImagesData');
                
                // Show success message
                showMessage('All images removed successfully!', 'success');
                
                // Refresh content to show no images
                refreshContent();
                
                // Also trigger a manual refresh of the main kiosk
                triggerMainKioskRefresh();
            }
        }
        
        function removeDefaultImages() {
            if (confirm('Remove the default Unsplash images and show placeholder content instead?')) {
                // Clear current images
                localStorage.removeItem('kioskImages');
                localStorage.removeItem('kioskData');
                localStorage.removeItem('websiteImagesData');
                
                // Show success message
                showMessage('Default images removed! Main kiosk will show placeholder content.', 'success');
                
                // Refresh content
                refreshContent();
                
                // Trigger main kiosk refresh
                triggerMainKioskRefresh();
            }
        }
        
        function triggerMainKioskRefresh() {
            // Create a storage event to notify the main kiosk
            const event = new StorageEvent('storage', {
                key: 'kioskData',
                newValue: null,
                oldValue: localStorage.getItem('kioskData'),
                url: window.location.href
            });
            window.dispatchEvent(event);
            
            // Also try to directly communicate with the main kiosk if it's open
            if (window.opener && !window.opener.closed) {
                try {
                    window.opener.postMessage({ action: 'refreshImages', data: null }, '*');
                } catch (e) {
                    console.log('Could not communicate with main kiosk window');
                }
            }
            
            // Show instructions
            showMessage('Images removed! Go back to main kiosk to see changes.', 'success');
        }
        
        // Add Images by URL Functions
        function showAddByURL() {
            document.getElementById('add-url-modal').style.display = 'block';
        }

        function hideAddByURL() {
            document.getElementById('add-url-modal').style.display = 'none';
            document.getElementById('hero-url-preview').innerHTML = '';
            document.getElementById('gallery-url-preview').innerHTML = '';
            document.getElementById('murti-url-preview').innerHTML = '';
        }

        function previewURLImages(inputId, previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = ''; // Clear previous previews
            const urls = document.getElementById(inputId).value.split('\n').map(url => url.trim()).filter(url => url);
            
            for (let i = 0; i < urls.length; i++) {
                const img = document.createElement('img');
                img.src = urls[i];
                img.style.maxWidth = '100px';
                img.style.height = 'auto';
                preview.appendChild(img);
            }
        }

        function processURLImages() {
            const heroUrls = document.getElementById('hero-urls').value.split('\n').map(url => url.trim()).filter(url => url);
            const galleryUrls = document.getElementById('gallery-urls').value.split('\n').map(url => url.trim()).filter(url => url);
            const murtiUrl = document.getElementById('murti-url').value.trim();

            if (heroUrls.length === 0 && galleryUrls.length === 0 && !murtiUrl) {
                showMessage('Please enter at least one URL to add.', 'error');
                return;
            }

            const currentImages = JSON.parse(localStorage.getItem('kioskImages') || '{}');
            
            // Initialize arrays if they don't exist
            if (!currentImages.heroSlider) currentImages.heroSlider = [];
            if (!currentImages.generalImages) currentImages.generalImages = [];
            if (!currentImages.murtiDarshan) currentImages.murtiDarshan = [];

            // Add hero slider images
            if (heroUrls.length > 0) {
                heroUrls.forEach((url, index) => {
                    currentImages.heroSlider.push({
                        url: url,
                        title: `Hero Image ${currentImages.heroSlider.length + 1}`,
                        description: 'Custom uploaded image'
                    });
                });
            }

            // Add gallery images
            if (galleryUrls.length > 0) {
                galleryUrls.forEach((url, index) => {
                    currentImages.generalImages.push({
                        url: url,
                        title: `Gallery Image ${currentImages.generalImages.length + 1}`,
                        description: 'Custom uploaded image'
                    });
                });
            }

            // Add murti darshan image (replace existing)
            if (murtiUrl) {
                currentImages.murtiDarshan = [{
                    url: murtiUrl,
                    title: 'Murti Darshan Image',
                    description: 'Custom uploaded murti image'
                }];
            }

            // Save to localStorage
            localStorage.setItem('kioskImages', JSON.stringify(currentImages));
            
            // Also update kiosk data
            const kioskData = {
                websiteImages: currentImages,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('kioskData', JSON.stringify(kioskData));

            showMessage(`Successfully added ${heroUrls.length + galleryUrls.length + (murtiUrl ? 1 : 0)} images!`, 'success');
            hideAddByURL();
            refreshContent(); // Refresh content to show new images
        }
        
        // Language Management Functions
        function showLanguageManager() {
            document.getElementById('language-manager-modal').style.display = 'block';
            document.getElementById('current-language-display').textContent = MANDIR_CONFIG.language || 'English';
            updateLanguageStatus();
        }

        function hideLanguageManager() {
            document.getElementById('language-manager-modal').style.display = 'none';
        }

        function changeLanguageFromAdmin(lang) {
            if (MANDIR_CONFIG && MANDIR_CONFIG.language === lang) {
                showMessage('Already in this language.', 'info');
                return;
            }
            MANDIR_CONFIG.language = lang;
            localStorage.setItem('kioskConfig', JSON.stringify(MANDIR_CONFIG));
            showMessage(`Switched to ${lang.toUpperCase()}!`, 'success');
            document.getElementById('current-language-display').textContent = lang.toUpperCase();
            updateLanguageStatus();
        }

        function updateLanguageStatus() {
            const languageStatusDisplay = document.getElementById('language-status-display');
            languageStatusDisplay.innerHTML = ''; // Clear previous status
            if (MANDIR_CONFIG && MANDIR_CONFIG.language) {
                languageStatusDisplay.innerHTML += '<p>✅ ' + MANDIR_CONFIG.language.toUpperCase() + ' - Fully supported</p>';
            } else {
                languageStatusDisplay.innerHTML += '<p>❌ No language configured</p>';
            }
        }
        
        function testLanguageSwitch() {
            showMessage('Testing language switch functionality...', 'success');
            
            // Test if we can communicate with the main kiosk
            try {
                if (window.opener && !window.opener.closed) {
                    // Try to change language in main kiosk
                    window.opener.postMessage({ action: 'changeLanguage', language: 'gu' }, '*');
                    showMessage('Language switch test sent to main kiosk!', 'success');
                } else {
                    showMessage('Main kiosk not found. Open main kiosk in another tab to test.', 'warning');
                }
            } catch (e) {
                showMessage('Error testing language switch: ' + e.message, 'error');
            }
        }
        
        function testLanguageSwitch() {
            showMessage('Testing language switch functionality...', 'success');
            
            // Test if we can communicate with the main kiosk
            try {
                if (window.opener && !window.opener.closed) {
                    // Try to change language in main kiosk
                    window.opener.postMessage({ action: 'changeLanguage', language: 'gu' }, '*');
                    showMessage('Language switch test sent to main kiosk!', 'success');
                } else {
                    showMessage('Main kiosk not found. Open main kiosk in another tab to test.', 'warning');
                }
            } catch (e) {
                showMessage('Error testing language switch: ' + e.message, 'error');
            }
        }

        function exportLanguageData() {
            if (MANDIR_CONFIG) {
                const dataStr = JSON.stringify(MANDIR_CONFIG, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `kiosk-language-config-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                showMessage('Language configuration exported successfully!', 'success');
            } else {
                showMessage('No language configuration found to export.', 'info');
            }
        }

        // Upcoming Dates Management Functions
        function showUpcomingDatesManager() {
            document.getElementById('upcoming-dates-modal').style.display = 'block';
            displayCurrentDates();
        }

        function hideUpcomingDatesManager() {
            document.getElementById('upcoming-dates-modal').style.display = 'none';
        }

        function displayCurrentDates() {
            const currentDatesDisplay = document.getElementById('current-dates-display');
            currentDatesDisplay.innerHTML = ''; // Clear previous dates
            const savedDates = localStorage.getItem('kioskDates');
            if (savedDates) {
                try {
                    const dates = JSON.parse(savedDates);
                    if (dates.length > 0) {
                        dates.forEach(event => {
                            currentDatesDisplay.innerHTML += `
                                <div class="event-item">
                                    <strong>${event.date} (${event.time}):</strong> ${event.title} - ${event.description}
                                </div>
                            `;
                        });
                    } else {
                        currentDatesDisplay.innerHTML = '<p>No upcoming dates found in storage.</p>';
                    }
                } catch (e) {
                    currentDatesDisplay.innerHTML = '<p>Error parsing upcoming dates data.</p>';
                }
            } else {
                currentDatesDisplay.innerHTML = '<p>No upcoming dates found in storage.</p>';
            }
        }

        function addNewEvent() {
            const newEventDate = document.getElementById('new-event-date').value.trim();
            const newEventTitle = document.getElementById('new-event-title').value.trim();
            const newEventTime = document.getElementById('new-event-time').value.trim();
            const newEventDescription = document.getElementById('new-event-description').value.trim();

            if (!newEventDate || !newEventTitle) {
                showMessage('Date and Event Title are required.', 'error');
                return;
            }

            const currentDates = JSON.parse(localStorage.getItem('kioskDates') || '[]');
            currentDates.push({
                date: newEventDate,
                time: newEventTime || 'N/A',
                title: newEventTitle,
                description: newEventDescription || 'No description provided'
            });

            localStorage.setItem('kioskDates', JSON.stringify(currentDates));
            showMessage('Event added successfully!', 'success');
            displayCurrentDates(); // Refresh display
            hideUpcomingDatesManager(); // Close modal
        }

        function exportDatesData() {
            const datesData = localStorage.getItem('kioskDates');
            if (datesData) {
                const dataStr = JSON.stringify(JSON.parse(datesData), null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `kiosk-upcoming-dates-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                showMessage('Upcoming dates data exported successfully!', 'success');
            } else {
                showMessage('No upcoming dates data found to export.', 'info');
            }
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            console.log('🚀 Simple Admin page loaded successfully!');
            
            // Check if config is loaded
            if (typeof MANDIR_CONFIG !== 'undefined') {
                console.log('✅ Config loaded:', MANDIR_CONFIG.gallery ? `${MANDIR_CONFIG.gallery.length} images` : 'No gallery');
            } else {
                console.log('⚠️ Config not loaded');
            }
        });
    </script>
</body>
</html>
